import{useExpensesStore as e}from"./expenses.store-YFn4EKUG.js";import{u as a,V as l,_ as t,k as s,w as n,y as u,a as o,s as r,m as d,t as i}from"./index-kUCeoXe8.js";import{E as c,M as v}from"./ExpenseItem-DdZjBevW.js";import{e as p,b as m,c as _,E as f,H as g,z as y,af as x,K as b,G as h,j as C,ac as V,aa as D,a1 as w,_ as E,W as Y,l as k,$ as B,ae as U,A,J as M,F as j,ab as I,L as S,M as T,N as O,u as $}from"./vue-vendor-DpnofNfo.js";import{u as F}from"./toast.store-D86bTs2s.js";import{C as N}from"./Check.icon-YXoriN3Y.js";import{D as L,_ as G}from"./DateSelector-aV-IP_rm.js";import{u as P}from"./accounts.store-BzaUBVst.js";import{u as z}from"./useConfirm-DwzhtzI4.js";import{_ as K}from"./Filter.icon.vue_vue_type_script_setup_true_lang-B34yG760.js";import{E as W}from"./EmptyState-DmADnuFN.js";import{d as q}from"./utils-CfCBEYwL.js";import{_ as H,A as J}from"./SideDrawer.vue_vue_type_style_index_0_lang-CbuBtalK.js";import{P as R}from"./PageHeader-BCBBA5by.js";import{e as Q}from"./variables.styles-BivaIJLK.js";import{$ as X}from"./vuetify-vendor-BWjtgv5e.js";import"./config.service-BNV0N1DJ.js";import"./firebase-vendor-B7qOPrSY.js";const Z={class:"add-expense"},ee={class:"add-expense__bar"},ae={class:"add-expense__value"},le={class:"add-expense__input"},te={class:"add-expense__actions"},se=t(p({__name:"AddExpense",props:{selectedDate:{default:()=>new Date}},setup(t){const s=t,n=F(),u=e(),o=/iPad|iPhone|iPod/.test(navigator.userAgent),r=m(!1);let d=null;const i=m(),c=m(),v=m({name:"",value:null,account:null}),p=_((()=>v.value.value||0===v.value.value?v.value.value.toLocaleString("es-CO"):"")),C=e=>{const a=Number(e.replace(/[^\d]/g,""));v.value.value=isNaN(a)?null:a},V=()=>{""!==v.value.name.trim()&&c.value?.focus()},D=()=>{v.value.name&&v.value.value&&(u.addExpense({name:v.value.name,value:v.value.value,account:v.value.account,date:s.selectedDate}),n.success("Movimiento guardado"),v.value={name:"",value:null,account:null})},w=e=>{d&&(clearTimeout(d),d=null),o&&!r.value&&setTimeout((()=>{e?.$el?.scrollIntoView({behavior:"smooth",block:"nearest",inline:"nearest"})}),300),r.value=!0},E=()=>{d=setTimeout((()=>{r.value=!1,o&&window.scrollTo({top:0,behavior:"smooth"})}),200)};return(e,t)=>(h(),f("div",Z,[g("div",ee,[g("div",ae,[y(a,{class:"secondary-input",ref_key:"valueInput",ref:i,density:"compact",label:"Valor","hide-details":"",type:"text",prefix:"$","onUpdate:modelValue":C,"model-value":p.value,maxlength:"12",onKeyup:x(V,["enter"]),onFocus:t[0]||(t[0]=e=>w(i.value)),onBlur:E,inputmode:"numeric",pattern:"[0-9]*"},null,8,["model-value"])]),g("div",le,[y(a,{ref_key:"descInput",ref:c,modelValue:v.value.name,"onUpdate:modelValue":t[1]||(t[1]=e=>v.value.name=e),class:"secondary-input",label:"Descripción",density:"compact",maxlength:100,onKeyup:x(D,["enter"]),"hide-details":"",onFocus:t[2]||(t[2]=e=>w(c.value)),onBlur:E},null,8,["modelValue"])]),g("div",te,[y(l,{class:"btn-fab add-expense__save",onClick:D,ripple:!1,disabled:!v.value.name||!v.value.value},{default:b((()=>[y(N)])),_:1},8,["disabled"])])])]))}}),[["__scopeId","data-v-0b415584"]]),ne={class:"edit-expense"},ue={class:"edit-expense__bar"},oe={class:"edit-expense__input"},re={class:"edit-expense__input edit-expense__value"},de={class:"edit-expense__more"},ie={class:"edit-expense__toggles"},ce={class:"mt-3"},ve={class:"edit-expense__actions"},pe={key:0,class:"edit-expense__delete"},me=t(p({__name:"EditExpense",props:{modelValue:{type:Boolean,default:!1},expense:{default:null}},emits:["update:modelValue","save","delete"],setup(e,{emit:t}){const u=e,o=t,r=P(),d=z(),i=m(),c=m(),v=m(!1),p=m({id:"",name:"",value:0,selectedAccount:null,date:s().format("YYYY-MM-DD")}),Y=_((()=>r.accounts.map((e=>({id:e.id,name:e.name}))))),k=_((()=>0===p.value.value?"":p.value.value||0===p.value.value?p.value.value.toLocaleString("es-CO"):"")),B=_({get:()=>{if(!p.value.date)return new Date;const[e,a,l]=p.value.date.split("-");return new Date(Date.UTC(parseInt(e),parseInt(a)-1,parseInt(l)))},set:e=>{const a=e.getUTCFullYear(),l=String(e.getUTCMonth()+1).padStart(2,"0"),t=String(e.getUTCDate()).padStart(2,"0");p.value.date=`${a}-${l}-${t}`}}),U=e=>{const a=Number(e.replace(/[^\d]/g,""));p.value.value=isNaN(a)?0:a},A=e=>{const a=e.getUTCFullYear(),l=String(e.getUTCMonth()+1).padStart(2,"0"),t=String(e.getUTCDate()).padStart(2,"0");p.value.date=`${a}-${l}-${t}`},M=()=>{""!==p.value.name.trim()&&c.value?.focus()},j=()=>{v.value=!1,o("update:modelValue",!1),p.value={id:"",name:"",value:0,selectedAccount:null,date:s().format("YYYY-MM-DD")}},I=()=>{if(!p.value.name||!p.value.value||!u.expense)return;const e={...u.expense,name:p.value.name,value:p.value.value,account:p.value.selectedAccount||null,date:p.value.date};o("save",e),j()},S=async()=>{if(!u.expense?.id)return;await d({title:"Eliminar gasto",message:"¿Estás seguro de que deseas eliminar este gasto?"})&&u.expense.id&&(o("delete",u.expense.id),j())},T=()=>{if(u.expense){const e=null;p.value={id:u.expense.id,name:u.expense.name,value:u.expense.value,selectedAccount:u.expense.account||e,date:s(u.expense.date).format("YYYY-MM-DD")}}};return C((()=>u.modelValue),(e=>{v.value=e,e&&u.expense&&(T(),setTimeout((()=>i.value?.focus()),100))})),C((()=>u.expense),(()=>{u.modelValue&&u.expense&&T()}),{deep:!0}),(e,t)=>(h(),f("div",{class:V(["edit-expense__container",{"edit-expense--focused":v.value}])},[v.value?(h(),f("div",{key:0,class:"edit-expense__overlay",onClick:j})):D("",!0),g("div",ne,[t[5]||(t[5]=g("div",{class:"edit-expense__header"},[g("div",{class:"subtitle"},"Editar gasto")],-1)),g("div",ue,[g("div",oe,[y(a,{ref_key:"descriptionInput",ref:i,modelValue:p.value.name,"onUpdate:modelValue":t[0]||(t[0]=e=>p.value.name=e),density:"compact",label:"Descripción*","hide-details":"",type:"text",maxlength:"100",onKeydown:x(w(M,["prevent"]),["enter"]),class:"general-input",enterkeyhint:"next"},null,8,["modelValue","onKeydown"])]),g("div",re,[y(a,{ref_key:"valueInput",ref:c,class:"general-input",density:"compact",label:"Valor*","hide-details":"",prefix:"$","onUpdate:modelValue":U,"model-value":k.value,maxlength:"12",onKeyup:x(I,["enter"]),pattern:"[0-9]*",enterkeyhint:"done"},null,8,["model-value"])])]),g("div",de,[g("div",ie,[y(L,{onOnChange:A,modelValue:B.value,"onUpdate:modelValue":t[1]||(t[1]=e=>B.value=e)},null,8,["modelValue"])]),g("div",ce,[y(n,{class:"general-input",modelValue:p.value.selectedAccount,"onUpdate:modelValue":t[2]||(t[2]=e=>p.value.selectedAccount=e),items:Y.value,"item-title":"name","return-object":"",label:"Cuenta",density:"comfortable","hide-details":""},null,8,["modelValue","items"])])]),g("div",ve,[y(l,{type:"button",class:"btn-neutro",onClick:j},{default:b((()=>t[3]||(t[3]=[E("Cancelar")]))),_:1}),y(l,{type:"button",class:"btn-primary",onClick:I,disabled:!p.value.name||!p.value.value},{default:b((()=>t[4]||(t[4]=[E(" Guardar ")]))),_:1},8,["disabled"])]),e.expense?(h(),f("div",pe,[g("p",{onClick:S},"Eliminar gasto")])):D("",!0)])],2))}}),[["__scopeId","data-v-bdbe3c81"]]),_e={class:"expenses-summary"},fe={class:"text-center"},ge={class:"expenses-summary__amount"},ye=t(p({__name:"ExpensesSummary",props:{total:{}},setup(e){const a=e,l=_((()=>new Intl.NumberFormat("es-CO",{style:"currency",currency:"COP",minimumFractionDigits:0}).format(a.total)));return(e,a)=>(h(),f("div",_e,[g("div",fe,[a[0]||(a[0]=g("div",{class:"expenses-summary__label"},"Total Gastos",-1)),g("div",ge,Y(l.value),1)])]))}}),[["__scopeId","data-v-3c49c819"]]),xe={class:"search-filter"},be={class:"search-filter__search"},he={class:"search-filter__filters"},Ce={class:"search-filter__actions"},Ve=t(p({__name:"ExpensesFilter",props:{initialGroupBy:{},initialOrderBy:{},searchLabel:{default:"Buscar por nombre"}},emits:["filterChange"],setup(t,{emit:s}){const o=[{label:"No agrupar",type:"none"},{label:"Cuenta",type:"account"},{label:"Fecha",type:"date"}],r=[{label:"Más reciente",filter:"newest"},{label:"Más antiguo",filter:"oldest"},{label:"Mayor monto",filter:"highest"},{label:"Menor monto",filter:"lowest"}],d=s,i=e(),c=m(!1),v=m(""),p=m(i.filterConfig.groupBy||"date"),_=m(i.filterConfig.orderBy||"newest"),x=m(window.innerWidth);k((()=>{window.addEventListener("resize",V)})),B((()=>{window.removeEventListener("resize",V)})),C((()=>i.filterConfig.groupBy),(e=>{void 0!==e&&(p.value=e)})),C((()=>i.filterConfig.orderBy),(e=>{void 0!==e&&(_.value=e)}));const V=()=>{x.value=window.innerWidth};return C([v,p,_],(()=>{const e={search:v.value,groupBy:p.value,orderBy:_.value};d("filterChange",e),(p.value||_.value)&&i.setFilterConfiguration(p.value,_.value)})),(e,t)=>(h(),f("div",xe,[g("div",be,[y(u,{modelValue:c.value,"onUpdate:modelValue":t[4]||(t[4]=e=>c.value=e),"close-on-content-click":!1},{activator:b((({props:e})=>[g("div",A({class:"search-filter__icon"},e),[y(K)],16)])),default:b((()=>[g("div",he,[y(n,{modelValue:p.value,"onUpdate:modelValue":t[0]||(t[0]=e=>p.value=e),items:o,"item-title":"label","item-value":"type",label:"Agrupar por","return-object":!1,class:"general-input",density:"comfortable"},null,8,["modelValue"]),y(n,{modelValue:_.value,"onUpdate:modelValue":t[1]||(t[1]=e=>_.value=e),items:r,"item-title":"label","item-value":"filter",label:"Ordenar por",class:"general-input",density:"comfortable"},null,8,["modelValue"]),g("div",Ce,[y(l,{onClick:t[2]||(t[2]=e=>c.value=!1),type:"button",class:"btn-label"},{default:b((()=>t[6]||(t[6]=[E(" Cerrar ")]))),_:1}),y(l,{onClick:t[3]||(t[3]=e=>(c.value=!1,v.value="",p.value="date",void(_.value="newest"))),type:"button",class:"btn-label primary"},{default:b((()=>t[7]||(t[7]=[E(" Limpiar ")]))),_:1})])])])),_:1},8,["modelValue"]),y(a,{class:"search-input",modelValue:v.value,"onUpdate:modelValue":t[5]||(t[5]=e=>v.value=e),label:e.searchLabel,density:"compact"},{prepend:b((()=>[y(G)])),_:1},8,["modelValue","label"]),U(e.$slots,"actions",{},void 0,!0)])]))}}),[["__scopeId","data-v-9c90e27c"]]),De={class:"expenses__list"},we={key:1,class:"expenses__list-content"},Ee=["onClick"],Ye={class:"expense-group__title-content"},ke={class:"expense-group__chevron"},Be={class:"expense-group__total"},Ue={class:"expense-group__items"},Ae=t(p({__name:"ExpensesList",props:{expenses:{},groupedExpenses:{},groupTotals:{},groupBy:{}},emits:["edit","updateAccount","filterChange"],setup(e,{emit:a}){const l=e,t=a,s=m({}),n=e=>{if("date"===l.groupBy){const[a,l,t]=e.split("/"),s=new Date(parseInt(t),parseInt(l)-1,parseInt(a));return q(s)}return e},u=e=>{t("filterChange",e)};return(e,a)=>(h(),f("div",De,[y(Ve,{onFilterChange:u},{actions:b((()=>[U(e.$slots,"addButton",{},void 0,!0)])),_:3}),0===e.expenses.length?(h(),M(W,{key:0})):(h(),f("div",we,[(h(!0),f(j,null,I(e.groupedExpenses,((a,l)=>{return h(),f("div",{key:l,class:"expense-group"},["none"!==e.groupBy&&e.groupBy?(h(),f("p",{key:0,class:"expense-group__title",onClick:e=>(e=>{s.value[e]=!s.value[e]})(l)},[g("span",Ye,[g("span",null,Y(n(l)),1),g("span",ke,[y(o,{size:"17"},{default:b((()=>[E(Y(!1===s.value[l]?"mdi-chevron-down":"mdi-chevron-up"),1)])),_:2},1024)])]),g("span",Be,Y((t=e.groupTotals[l]||0,new Intl.NumberFormat("es-CO",{style:"currency",currency:"COP",minimumFractionDigits:0}).format(t))),1)],8,Ee)):D("",!0),y(O,{name:"slide"},{default:b((()=>[S(g("div",Ue,[(h(!0),f(j,null,I(a,(a=>(h(),M(c,{key:a.id,expense:a,onEdit:l=>e.$emit("edit",a),onUpdateAccount:l=>e.$emit("updateAccount",a.id,l)},null,8,["expense","onEdit","onUpdateAccount"])))),128))],512),[[T,!1!==s.value[l]]])])),_:2},1024)]);var t})),128))]))]))}}),[["__scopeId","data-v-17563054"]]),Me={class:"side-drawer-body"},je={class:"side-drawer-body__content"},Ie={class:"side-drawer-body__actions"},Se={key:0,class:"expenses-drawer__delete"},Te=t(p({__name:"ExpensesDrawer",setup(t,{expose:u}){const o=e(),d=P(),i=F(),c=z(),v=m(!1),p=m(!1),x=m(null),C=m({name:"",value:null,selectedAccount:null,date:s().format("YYYY-MM-DD")}),V=_((()=>d.accounts.map((e=>({id:e.id,name:e.name}))))),w=_((()=>C.value.value||0===C.value.value?C.value.value.toLocaleString("es-CO"):"")),k=_({get:()=>{if(!C.value.date)return new Date;const[e,a,l]=C.value.date.split("-");return new Date(Date.UTC(parseInt(e),parseInt(a)-1,parseInt(l)))},set:e=>{const a=e.getUTCFullYear(),l=String(e.getUTCMonth()+1).padStart(2,"0"),t=String(e.getUTCDate()).padStart(2,"0");C.value.date=`${a}-${l}-${t}`}}),B=e=>{const a=Number(e.replace(/[^\d]/g,""));C.value.value=isNaN(a)?null:a},U=e=>{k.value=e},A=()=>{v.value=!1,setTimeout((()=>{p.value=!1,x.value=null,C.value={name:"",value:null,selectedAccount:null,date:s().format("YYYY-MM-DD")}}),300)},j=()=>{C.value.name&&C.value.value&&(p.value&&x.value?(o.updateExpense({id:x.value,name:C.value.name,value:C.value.value,account:C.value.selectedAccount,date:new Date(C.value.date)}),i.success("Gasto actualizado")):(o.addExpense({name:C.value.name,value:C.value.value,account:C.value.selectedAccount,date:new Date(C.value.date)}),i.success("Gasto guardado")),A())},I=async()=>{if(x.value)try{await c({title:"¿Eliminar gasto?",message:"Esta acción no se puede deshacer"})&&(o.deleteExpense(x.value),i.success("Gasto eliminado"),A())}catch{}};return u({openDrawer:e=>{p.value=!1,x.value=null,C.value={name:"",value:null,selectedAccount:null,date:e?s(e).format("YYYY-MM-DD"):s().format("YYYY-MM-DD")},v.value=!0},openEditDrawer:e=>{p.value=!0,x.value=e.id,C.value={name:e.name,value:e.value,selectedAccount:e.account||null,date:s(e.date).format("YYYY-MM-DD")},v.value=!0}}),(e,t)=>(h(),M(H,{modelValue:v.value,"onUpdate:modelValue":[t[3]||(t[3]=e=>v.value=e),t[4]||(t[4]=e=>{e||A()})],title:p.value?"Editar gasto":"Agregar gasto",width:420,persistent:""},{default:b((()=>[g("div",Me,[g("div",je,[y(a,{modelValue:C.value.name,"onUpdate:modelValue":t[0]||(t[0]=e=>C.value.name=e),class:"general-input mb-5",density:"comfortable",label:"Descripción*","hide-details":"",type:"text",maxlength:"100"},null,8,["modelValue"]),y(a,{class:"general-input mb-5",density:"comfortable",label:"Valor*","hide-details":"",prefix:"$","onUpdate:modelValue":B,"model-value":w.value,maxlength:"12",pattern:"[0-9]*",inputmode:"numeric"},null,8,["model-value"]),y(L,{onOnChange:U,modelValue:k.value,"onUpdate:modelValue":t[1]||(t[1]=e=>k.value=e)},null,8,["modelValue"]),y(n,{class:"general-input mt-5",modelValue:C.value.selectedAccount,"onUpdate:modelValue":t[2]||(t[2]=e=>C.value.selectedAccount=e),items:V.value,"item-title":"name","return-object":"",label:"Cuenta",density:"comfortable","hide-details":""},null,8,["modelValue","items"])]),g("div",Ie,[y(r),y(l,{type:"button",class:"btn-neutro",onClick:A},{default:b((()=>t[5]||(t[5]=[E(" Cancelar ")]))),_:1}),y(l,{type:"button",class:"btn-primary",onClick:j,disabled:!C.value.name||!C.value.value},{default:b((()=>[E(Y(p.value?"Actualizar":"Guardar"),1)])),_:1},8,["disabled"])]),p.value?(h(),f("div",Se,[g("p",{onClick:I},"Eliminar gasto")])):D("",!0)])])),_:1},8,["modelValue","title"]))}}),[["__scopeId","data-v-8f339bf9"]]),Oe={class:"expenses"},$e={class:"expenses__selector"},Fe={class:"expenses__total-mobile"},Ne={class:"expenses__content"},Le={class:"expenses__total-desktop"},Ge={key:0,class:"expenses__add-btn"},Pe=t(p({__name:"ExpensesView",setup(a){const{mdAndUp:t}=X(),n=m(new Date),u=e(),o=m(""),r=m(null),c=m(!1),p=m(),x=m({groupBy:u.filterConfig.groupBy,orderBy:u.filterConfig.orderBy}),V=_((()=>{const e=s(n.value).startOf("month"),a=s(n.value).endOf("month");return u.expenses.filter((l=>{const t=s(l.date);return t.isAfter(e)&&t.isBefore(a)||t.isSame(e,"day")||t.isSame(a,"day")}))})),w=_((()=>{if(!o.value.trim())return V.value;const e=o.value.toLowerCase();return V.value.filter((a=>a.name.toLowerCase().includes(e)))})),E=_((()=>{const e=x.value.groupBy;return"none"!==e&&e?"account"===e?w.value.reduce(((e,a)=>{const l=a.account?.name||"Presupuesto";return e[l]||(e[l]=[]),e[l].push(a),e}),{}):"date"===e?w.value.reduce(((e,a)=>{const l=s(a.date).format("DD/MM/YYYY");return e[l]||(e[l]=[]),e[l].push(a),e}),{}):{all:w.value}:{all:w.value}})),Y=_((()=>{const e=x.value.orderBy,a={};return Object.entries(E.value).forEach((([l,t])=>{let n=[...t];"newest"===e?n.sort(((e,a)=>s(a.date).valueOf()-s(e.date).valueOf())):"oldest"===e?n.sort(((e,a)=>s(e.date).valueOf()-s(a.date).valueOf())):"highest"===e?n.sort(((e,a)=>a.value-e.value)):"lowest"===e&&n.sort(((e,a)=>e.value-a.value)),a[l]=n})),a})),k=_((()=>w.value.reduce(((e,a)=>e+a.value),0))),B=_((()=>{const e={};return Object.entries(Y.value).forEach((([a,l])=>{e[a]=l.reduce(((e,a)=>e+a.value),0)})),e})),U=e=>{o.value=e.search,x.value={groupBy:e.groupBy,orderBy:e.orderBy}},M=(e,a)=>{u.updateExpenseAccount(e,a)},j=e=>{t.value?p.value&&p.value.openEditDrawer(e):(r.value=e,c.value=!0)},I=()=>{p.value&&p.value.openDrawer(n.value)},S=e=>{u.updateExpense(e)},T=e=>{u.deleteExpense(e)};return C((()=>x.value),(()=>{d.queueBackup()}),{deep:!0}),(e,a)=>(h(),f("div",Oe,[y(R,{title:"Gastos del mes"}),g("div",$e,[y(v,{modelValue:n.value,"onUpdate:modelValue":a[0]||(a[0]=e=>n.value=e)},null,8,["modelValue"])]),g("div",Fe,[y(ye,{total:k.value},null,8,["total"])]),g("div",Ne,[g("div",Le,[y(ye,{total:k.value},null,8,["total"])]),y(Ae,{expenses:w.value,groupedExpenses:Y.value,groupTotals:B.value,groupBy:x.value.groupBy??null,onFilterChange:U,onEdit:j,onUpdateAccount:M},{addButton:b((()=>[$(t)?(h(),f("div",Ge,[y(i,{text:"Agregar gasto",location:"left"},{activator:b((({props:e})=>[y(l,A({color:$(Q),class:"btn-fab fab-button",onClick:I},e),{default:b((()=>[y(J,{class:"icon"})])),_:2},1040,["color"])])),_:1})])):D("",!0)])),_:1},8,["expenses","groupedExpenses","groupTotals","groupBy"])]),y(se,{selectedDate:n.value},null,8,["selectedDate"]),y(me,{modelValue:c.value,"onUpdate:modelValue":a[1]||(a[1]=e=>c.value=e),expense:r.value,onSave:S,onDelete:T},null,8,["modelValue","expense"]),y(Te,{ref_key:"expensesDrawerRef",ref:p},null,512)]))}}),[["__scopeId","data-v-8aac33cc"]]);export{Pe as default};
