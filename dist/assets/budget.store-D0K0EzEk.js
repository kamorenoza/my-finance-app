import{D as e,b as t,c as a}from"./vue-vendor-DpnofNfo.js";import{k as i,m as n}from"./index-Cv6rvNbY.js";import{g as o}from"./utils-BoBUMVz-.js";import{useExpensesStore as s}from"./expenses.store-D_UK2_mi.js";import{c as r}from"./config.service-BNV0N1DJ.js";import"./firebase-vendor-B7qOPrSY.js";import"./vuetify-vendor-BWjtgv5e.js";const u=()=>{const e=localStorage.getItem("user"),t=e?JSON.parse(e):null;return t?t.email:null},d={loadEntries:()=>{const e=u();if(!e)return[];const t=localStorage.getItem(`budget_${e}`),a=t?JSON.parse(t):[];let i=!1;const n=a.map((e=>e.id?e:(i=!0,{...e,id:o()})));return i&&localStorage.setItem(`budget_${e}`,JSON.stringify(n)),n},addEntry:e=>{const t=u();if(!t)return;const a=d.loadEntries();a.push(e),localStorage.setItem(`budget_${t}`,JSON.stringify(a))},updateEntry:e=>{const t=u();if(!t)return;const a=d.loadEntries().map((t=>t.id===e.id?e:t));localStorage.setItem(`budget_${t}`,JSON.stringify(a))},deleteEntry:e=>{const t=u();if(!t)return;const a=d.loadEntries().filter((t=>t.id!==e));localStorage.setItem(`budget_${t}`,JSON.stringify(a))}},l=e("budget",(()=>{const e=t(d.loadEntries()),o=t(i().startOf("month").toDate()),u=t(null),l=t(!1);(()=>{const e=r.getBudgetConfig();void 0!==e.addExpensesToBudget&&(l.value=e.addExpensesToBudget)})();const f=(e,t)=>{const a=i(t).format("YYYY-MM"),n=e.modifications?.find((e=>e.month===a));return n&&void 0!==n.isPaid?n.isPaid:e.isPaid},m=(e,t)=>{const a=i(t).format("YYYY-MM"),n=e.modifications?.find((e=>e.month===a));return n&&void 0!==n.value?n.value:e.value},c=a((()=>{const t=i(o.value);return e.value.filter((e=>{const a=i(e.date);if(e.isFixed)return a.isSameOrBefore(t,"month");if(e.repeat&&e.repeat>0){const i=a.add(e.repeat-1,"month");return t.isSameOrAfter(a,"month")&&t.isSameOrBefore(i,"month")}return a.isSame(t,"month")}))})),v=a((()=>c.value.filter((e=>"ingreso"===e.type)).reduce(((e,t)=>e+m(t,o.value)),0))),p=a((()=>c.value.filter((e=>"gasto"===e.type)).reduce(((e,t)=>e+m(t,o.value)),0))),g=a((()=>c.value.filter((e=>"ingreso"===e.type)).reduce(((e,t)=>e+m(t,o.value)),0))),h=a((()=>{let e=c.value.filter((e=>"gasto"===e.type)).reduce(((e,t)=>e+m(t,o.value)),0);if(l.value){const t=s(),a=i(o.value).startOf("month"),n=i(o.value).endOf("month");e+=t.expenses.filter((e=>{const t=i(e.date);return t.isAfter(a)&&t.isBefore(n)||t.isSame(a,"day")||t.isSame(n,"day")})).reduce(((e,t)=>e+t.value),0)}return e})),y=a((()=>c.value.filter((e=>"ingreso"===e.type&&f(e,o.value))).reduce(((e,t)=>e+m(t,o.value)),0))),E=a((()=>{let e=c.value.filter((e=>"gasto"===e.type&&f(e,o.value))).reduce(((e,t)=>e+m(t,o.value)),0);if(l.value){const t=s(),a=i(o.value).startOf("month"),n=i(o.value).endOf("month");e+=t.expenses.filter((e=>{const t=i(e.date);return t.isAfter(a)&&t.isBefore(n)||t.isSame(a,"day")||t.isSame(n,"day")})).reduce(((e,t)=>e+t.value),0)}return e}));return{entries:e,selectedDate:o,selectedEntry:u,addExpensesToBudget:l,loadEntries:()=>{e.value=d.loadEntries()},addEntry:t=>{d.addEntry(t),e.value.push(t),n.queueBackup()},updateEntry:t=>{const a=e.value.findIndex((e=>e.id===t.id));-1!==a&&(e.value[a]=t,d.updateEntry(t),n.queueBackup())},updateEntryWithModification:(t,a)=>{const s=e.value.findIndex((e=>e.id===t.id));if(-1!==s){const r=e.value[s],u=i(o.value).format("YYYY-MM");if(r.modifications||(r.modifications=[]),"this"===a){let e=r.modifications?.find((e=>e.month===u));e||(e={month:u,appliedTo:"this"},r.modifications.push(e)),t.name!==r.name&&(e.name=t.name),t.value!==r.value&&(e.value=t.value)}else if("all"===a){const e=r.modifications?.find((e=>e.month===u));r.modifications=[],e&&r.modifications.push(e),r.name=t.name,r.value=t.value}else if("future"===a){const e=i(u),a=i(r.date).startOf("month"),n=r.value,o=r.name,s=[];let d=a;for(;d.isBefore(e);){const e=d.format("YYYY-MM"),a=r.modifications?.find((t=>t.month===e));if(a)s.push(a);else{const a={month:e,value:n,appliedTo:"future"};o!==t.name&&(a.name=o),s.push(a)}d=d.add(1,"month")}const l=r.modifications?.find((e=>e.month===u));l&&s.push(l),r.modifications=s,r.name=t.name,r.value=t.value}d.updateEntry(r),n.queueBackup()}},updateEntryIsPaidForMonth:(t,a)=>{const s=e.value.findIndex((e=>e.id===t));if(-1!==s){const t=e.value[s],r=i(o.value).format("YYYY-MM");t.modifications||(t.modifications=[]);const u=t.modifications.findIndex((e=>e.month===r));-1!==u?t.modifications[u].isPaid=a:t.modifications.push({month:r,isPaid:a,appliedTo:"this"}),d.updateEntry(t),n.queueBackup()}},deleteEntry:t=>{e.value=e.value.filter((e=>e.id!==t)),d.deleteEntry(t),n.queueBackup()},setSelectedEntry:e=>{u.value=e},getDisplayValue:m,getDisplayIsPaid:f,filteredEntries:c,totalIncomes:v,totalExpenses:p,totalIncomesBudget:g,totalExpensesBudget:h,totalIncomesReal:y,totalExpensesReal:E}}));export{l as useBudgetStore};
