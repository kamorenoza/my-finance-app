import{e,E as a,G as t,H as l,J as s,aa as i,K as o,_ as n,a1 as d,ac as u,W as m,z as c,b as r,c as v,u as p,af as _,a8 as g,j as h,l as f,a9 as b,F as k,ab as y}from"./vue-vendor-DpnofNfo.js";import{useShoppingStore as C}from"./shopping.store-DSR1DFtk.js";import{_ as I,a as j}from"./Trash.icon.vue_vue_type_script_setup_true_lang-DS7Wic85.js";import{a as x,V as L,_ as V,n as A,p as E,q as S,u as w,r as N,o as D}from"./index-BKmd_Krn.js";import{b as T}from"./variables.styles-BivaIJLK.js";import{u as z}from"./useConfirm-qSJlo-LB.js";import{C as F}from"./Check.icon-DU3olO4E.js";import{A as O}from"./AddShoppingList-n7r7behF.js";import{P as $}from"./PageHeader-DTS669kw.js";import{E as q}from"./EmptyState-h6cVtKBs.js";import{d as U}from"./vuedraggable.umd-CatT2PzU.js";import{d as M,g as P}from"./utils-B_Mqw0aR.js";import{u as B}from"./toast.store-D86bTs2s.js";import"./firebase-vendor-iMlT5f4Z.js";import"./vuetify-vendor-BWjtgv5e.js";import"./SideDrawer.vue_vue_type_style_index_0_lang-PXTQhFlh.js";const K={class:"shopping-item"},R={class:"shopping-item__content"},G={class:"shopping-item__main"},H={class:"shopping-item__info"},J={class:"shopping-item__value"},W={class:"shopping-item__actions"},Q=V(e({__name:"ShoppingItemCard",props:{item:{},dragMode:{type:Boolean}},emits:["edit","toggleChecked"],setup:e=>(e,r)=>{return t(),a("div",K,[l("div",R,[e.dragMode?(t(),s(x,{key:0,class:"drag-handle",size:"20"},{default:o((()=>r[2]||(r[2]=[n("mdi-drag-vertical")]))),_:1})):i("",!0),l("div",G,[l("button",{class:u(["shopping-item__checkbox",{"shopping-item__checkbox--checked":e.item.checked}]),onClick:r[0]||(r[0]=d((a=>e.$emit("toggleChecked",e.item.id)),["stop"]))},[e.item.checked?(t(),s(x,{key:0,size:"16",color:"white"},{default:o((()=>r[3]||(r[3]=[n("mdi-check")]))),_:1})):i("",!0)],2),l("div",H,[l("div",{class:u(["shopping-item__name",{"shopping-item__name--checked":e.item.checked}])},[l("p",null,[n(m(e.item.name)+" ",1),l("span",J,m((v=e.item.amount,new Intl.NumberFormat("es-CO",{style:"currency",currency:"COP",minimumFractionDigits:0}).format(v))),1)])],2)])]),l("div",W,[c(L,{class:"shopping-item__edit-btn",variant:"text",onClick:r[1]||(r[1]=d((a=>e.$emit("edit",e.item)),["stop"]))},{default:o((()=>[c(I)])),_:1})])])]);var v}}),[["__scopeId","data-v-38d8dcf7"]]),X={key:0,class:"item-dialog__delete"},Y=V(e({__name:"AddShoppingItem",props:{listId:{}},emits:["save","delete"],setup(e,{expose:l,emit:d}){const u=z(),_=d,g=r(!1),h=r(!1),f=r(null),b=r({name:"",amount:0}),k=v((()=>b.value.amount&&0!==b.value.amount?b.value.amount.toLocaleString("es-CO"):"")),y=e=>{const a=Number(e.replace(/[^\d]/g,""));b.value.amount=isNaN(a)?0:a},C=()=>{g.value=!1,I()},I=()=>{b.value={name:"",amount:0},f.value=null,h.value=!1},j=()=>{if(!b.value.name||0===b.value.amount)return;const e={id:f.value||"",name:b.value.name,amount:b.value.amount,checked:!1,converted:!1,expenseId:null};_("save",e),C()},x=async()=>{if(f.value){await u({title:"Eliminar artículo",message:`¿Estás seguro de que deseas eliminar <strong>${b.value.name}</strong>?`,confirmColor:"red"})&&(_("delete",f.value),C())}};return l({openDialog:()=>{I(),h.value=!1,g.value=!0},openEditDialog:e=>{const a=e;b.value={name:e.name,amount:e.amount??a.estimatedAmount??0},f.value=e.id,h.value=!0,g.value=!0}}),(e,l)=>(t(),s(A,{modelValue:g.value,"onUpdate:modelValue":l[2]||(l[2]=e=>g.value=e),"max-width":"400",persistent:""},{default:o((()=>[c(D,{class:"item-dialog"},{default:o((()=>[c(E,{class:"item-dialog__title"},{default:o((()=>[n(m(h.value?"Editar":"Nuevo")+" artículo ",1)])),_:1}),c(S,{class:"item-dialog__content"},{default:o((()=>[c(w,{modelValue:b.value.name,"onUpdate:modelValue":l[0]||(l[0]=e=>b.value.name=e),label:"Nombre*",density:"comfortable","hide-details":"",class:"general-input mb-4"},null,8,["modelValue"]),c(w,{modelValue:k.value,"onUpdate:modelValue":[l[1]||(l[1]=e=>k.value=e),y],label:"Monto*",density:"comfortable","hide-details":"",prefix:"$",class:"general-input"},null,8,["modelValue"])])),_:1}),c(N,{class:"item-dialog__actions"},{default:o((()=>[c(L,{class:"btn-label",onClick:C},{default:o((()=>l[3]||(l[3]=[n("Cancelar")]))),_:1}),c(L,{class:"btn-label",color:p(T),onClick:j,disabled:!b.value.name||0===b.value.amount},{default:o((()=>l[4]||(l[4]=[n(" Guardar ")]))),_:1},8,["color","disabled"])])),_:1}),h.value?(t(),a("div",X,[c(L,{class:"btn-label item-dialog__delete-btn",variant:"text",color:"error",onClick:x},{default:o((()=>l[5]||(l[5]=[n(" Eliminar artículo ")]))),_:1})])):i("",!0)])),_:1})])),_:1},8,["modelValue"]))}}),[["__scopeId","data-v-51e53492"]]),Z={class:"add-item-inline"},ee={class:"add-item-inline__content"},ae=V(e({__name:"AddShoppingItemInline",emits:["save"],setup(e,{emit:s}){const i=s,n=r(),d=r({name:"",amount:0}),u=v((()=>d.value.name.trim()&&d.value.amount>0)),m=v({get:()=>0===d.value.amount?"":d.value.amount.toLocaleString("es-CO"),set:e=>{const a=Number(e.replace(/[^\d]/g,""));d.value.amount=isNaN(a)?0:a}}),p=e=>{const a=Number(e.replace(/[^\d]/g,""));d.value.amount=isNaN(a)?0:a},g=()=>{d.value.name.trim()&&n.value?.focus()},h=()=>{const e=document.querySelector(".list-detail");e&&(e.scrollLeft=0)},f=()=>{d.value.name.trim()&&d.value.amount>0&&(i("save",d.value.name,d.value.amount),b())},b=()=>{d.value={name:"",amount:0}};return(e,s)=>(t(),a("div",Z,[c(D,{class:"add-item-inline__card"},{default:o((()=>[l("div",ee,[c(w,{ref_key:"amountInput",ref:n,modelValue:m.value,"onUpdate:modelValue":[s[0]||(s[0]=e=>m.value=e),p],placeholder:"Monto",density:"comfortable","hide-details":"",prefix:"$",class:"general-input add-item-inline__amount",maxlength:"12",inputmode:"numeric",pattern:"[0-9]*",onKeyup:_(f,["enter"]),onFocus:h},null,8,["modelValue"]),c(w,{modelValue:d.value.name,"onUpdate:modelValue":s[1]||(s[1]=e=>d.value.name=e),placeholder:"Descripción",density:"comfortable","hide-details":"",class:"general-input add-item-inline__name",onKeyup:_(g,["enter"])},null,8,["modelValue"])])])),_:1}),c(L,{ripple:!1,class:"btn-fab add-item-inline__save",disabled:!u.value,onClick:f},{default:o((()=>[c(F)])),_:1},8,["disabled"])]))}}),[["__scopeId","data-v-b1816a01"]]),te={class:"shopping-stats"},le={class:"stat-item"},se={class:"stat-body items"},ie={class:"stat-value"},oe={class:"stat-body"},ne={class:"stat-value"},de={class:"stat-item"},ue={class:"stat-body items"},me={class:"stat-value"},ce={class:"stat-body"},re={class:"stat-value"},ve=V(e({__name:"ShoppingStats",props:{totalItems:{},completedCount:{},totalList:{},totalCompleted:{}},setup(e){const s=e=>new Intl.NumberFormat("es-CO",{style:"currency",currency:"COP",minimumFractionDigits:0}).format(e);return(e,i)=>(t(),a("div",te,[l("div",le,[l("div",se,[i[0]||(i[0]=l("span",{class:"stat-label"},"Items",-1)),l("span",ie,m(e.totalItems),1)]),l("div",oe,[i[1]||(i[1]=l("span",{class:"stat-label"},"Total",-1)),l("span",ne,m(s(e.totalList)),1)])]),l("div",de,[l("div",ue,[i[2]||(i[2]=l("span",{class:"stat-label"},"Completados",-1)),l("span",me,m(e.completedCount),1)]),l("div",ce,[i[3]||(i[3]=l("span",{class:"stat-label"},"Total",-1)),l("span",re,m(s(e.totalCompleted)),1)])])]))}}),[["__scopeId","data-v-6e22a39c"]]),pe={class:"list-detail"},_e={class:"list-detail__date"},ge={class:"list-detail__content"},he={class:"list-detail__items"},fe={key:0,class:"list-detail__toolbar"},be={key:2,class:"list-detail__scroll"},ke=V(e({__name:"ShoppingListDetailView",setup(e){const d=b(),_=g(),V=C(),A=B(),E=z(),S=r(),w=r(),N=r(!1),D=v((()=>_.params.id)),T=v((()=>V.shoppingLists.find((e=>e.id===D.value)))),F=v((()=>T.value?M(T.value.createdDate):"")),K=v((()=>T.value?T.value.items.filter((e=>e.checked)).length:0)),R=v((()=>T.value?T.value.items.filter((e=>!e.checked)).reduce(((e,a)=>e+((a.amount??a.estimatedAmount)||0)),0):0)),G=v((()=>T.value?T.value.items.filter((e=>e.checked)).reduce(((e,a)=>e+((a.amount??a.estimatedAmount)||0)),0):0)),H=r([]);h((()=>T.value?.items),(e=>{if(!e)return;const a=e.filter((e=>!e.checked)),t=H.value.map((e=>e.id)),l=a.map((e=>e.id)),s=t.length===l.length&&l.every((e=>t.includes(e)));H.value=s?t.map((e=>a.find((a=>a.id===e)))):a}),{immediate:!0,deep:!0});const J=v((()=>T.value?T.value.items.filter((e=>e.checked)).sort(((e,a)=>{const t=e.checkedAt?new Date(e.checkedAt).getTime():0;return(a.checkedAt?new Date(a.checkedAt).getTime():0)-t})):[])),W=()=>{V.reorderItems(D.value,H.value.map((e=>e.id)))},X=()=>{d.push("/compras")},Z=()=>{w.value&&T.value&&w.value.openEditDialog(T.value)},ee=e=>{S.value&&S.value.openEditDialog(e)},te=(e,a)=>{const t={id:P(),name:e,amount:a,checked:!1,converted:!1,expenseId:null};V.addItemToList(D.value,t),A.success("Artículo agregado")},le=e=>{if(e.id)V.updateItemInList(D.value,e),A.success("Artículo actualizado");else{const a={...e,id:P()};V.addItemToList(D.value,a),A.success("Artículo agregado")}},se=async e=>{V.deleteItemFromList(D.value,e),A.success("Artículo eliminado")},ie=e=>{V.toggleItemChecked(D.value,e)},oe=async()=>{await E({title:"Eliminar lista",message:`¿Estás seguro de que deseas eliminar la lista "${T.value?.name}"?`,confirmColor:"red"})&&(V.deleteShoppingList(D.value),A.success("Lista eliminada"),d.push("/compras"))};return f((()=>{T.value||(A.error("Lista no encontrada"),d.push("/compras"))})),(e,d)=>(t(),a("div",pe,[c($,{title:T.value?.name,"show-back":"",onBack:X},{actions:o((()=>[c(L,{class:"list-detail__action",size:"small",variant:"text",onClick:Z},{default:o((()=>[c(I)])),_:1}),c(L,{class:"list-detail__action delete",size:"small",variant:"text",onClick:oe},{default:o((()=>[c(j)])),_:1})])),_:1},8,["title"]),l("span",_e,m(F.value),1),l("div",ge,[c(ve,{"total-items":T.value?.items.length||0,"completed-count":K.value,"total-list":R.value,"total-completed":G.value},null,8,["total-items","completed-count","total-list","total-completed"]),l("div",he,[c(ae,{onSave:te}),T.value&&T.value.items.length>0?(t(),a("div",fe,[l("button",{class:u(["list-detail__reorder-btn",{"list-detail__reorder-btn--active":N.value}]),onClick:d[0]||(d[0]=e=>N.value=!N.value)},[c(x,{size:"16"},{default:o((()=>d[1]||(d[1]=[n("mdi-swap-vertical")]))),_:1}),n(" "+m(N.value?"Listo":"Reorganizar"),1)],2)])):i("",!0),T.value&&0!==T.value.items.length?(t(),a("div",be,[c(p(U),{list:H.value,"item-key":"id",handle:".drag-handle",onEnd:W,"ghost-class":"drag-ghost"},{item:o((({element:e})=>[(t(),s(Q,{key:e.id,item:e,"drag-mode":N.value,onEdit:ee,onToggleChecked:ie},null,8,["item","drag-mode"]))])),_:1},8,["list"]),(t(!0),a(k,null,y(J.value,(e=>(t(),s(Q,{key:e.id,item:e,onEdit:ee,onToggleChecked:ie},null,8,["item"])))),128))])):(t(),s(q,{key:1,message:"No hay artículos en esta lista"}))])]),c(Y,{ref_key:"addItemRef",ref:S,"list-id":D.value,onSave:le,onDelete:se},null,8,["list-id"]),c(O,{ref_key:"editListRef",ref:w,"show-fab":!1},null,512)]))}}),[["__scopeId","data-v-8fd7fd36"]]);export{ke as default};
