import{D as e}from"./vue-vendor-CQiCTXSV.js";import{g as t}from"./utils-alPBo_3K.js";import{m as o}from"./index-B8_2VSAt.js";import{useExpensesStore as n}from"./expenses.store-C3AC9yTf.js";var c=(e=>(e.loan="loan",e.TC="TC",e.normal="normal",e))(c||{}),s=(e=>(e[e.list=0]="list",e[e.carousel=1]="carousel",e))(s||{});const r=[{type:"loan",label:"Créditos"},{type:"TC",label:"Tarjeta de crédito"},{type:"normal",label:"Ahorros"}],a=[{filter:"name",label:"Nombre"},{filter:"type",label:"Tipo"}],u=()=>{const e=localStorage.getItem("user"),t=e?JSON.parse(e):null;return t?t.email:null},i={loadAccounts:()=>{const e=u();if(!e)return[];const t=localStorage.getItem(`accounts_${e}`);return t?JSON.parse(t):[]},addAccount:e=>{const t=u();if(!t)return;const o=i.loadAccounts();o.push(e),localStorage.setItem(`accounts_${t}`,JSON.stringify(o))},updateAccount:e=>{const t=u();if(!t)return;const o=i.loadAccounts().map((t=>t.id===e.id?e:t));localStorage.setItem(`accounts_${t}`,JSON.stringify(o))},deleteAccount:e=>{const t=u();if(!t)return;let o=i.loadAccounts();o=o.filter((t=>t.id!==e.id)),localStorage.setItem(`accounts_${t}`,JSON.stringify(o))},saveViewConfiguration:e=>{const t=u();t&&localStorage.setItem(`viewAccountConfiguration_${t}`,JSON.stringify(e))},getViewConfiguration:()=>{const e=s.carousel,t=u();if(!t)return e;const o=`viewAccountConfiguration_${t}`,n=localStorage.getItem(o);if(n)try{return JSON.parse(n)}catch{}return localStorage.setItem(o,JSON.stringify(e)),e},addExpenseToAccount:(e,t)=>{const o=u();if(!o)return;const n=i.loadAccounts().map((o=>{if(o.id===e){const e=[...o.expenses??[],t];return{...o,expenses:e}}return o}));localStorage.setItem(`accounts_${o}`,JSON.stringify(n))},updateExpenseInAccount:(e,t)=>{const o=u();if(!o)return;const n=i.loadAccounts().map((o=>{if(o.id===e){const e=(o.expenses??[]).map((e=>e.id===t.id?t:e));return{...o,expenses:e}}return o}));localStorage.setItem(`accounts_${o}`,JSON.stringify(n))},deleteExpenseFromAccount:(e,t)=>{const o=u();if(!o)return;const n=i.loadAccounts().map((o=>{if(o.id===e){const e=(o.expenses??[]).filter((e=>e.id!==t));return{...o,expenses:e}}return o}));localStorage.setItem(`accounts_${o}`,JSON.stringify(n))}},l=e("accounts",{state:()=>({viewMode:i.getViewConfiguration(),accounts:i.loadAccounts(),search:"",selectedType:"all",sortBy:"name",currentIndexAccount:0,selectedExpense:null}),getters:{filteredAccounts(e){let t=[...e.accounts];if("all"!==e.selectedType&&(t=t.filter((t=>t.type===e.selectedType))),e.search.trim()){const o=e.search.toLowerCase();t=t.filter((e=>e.name.toLowerCase().includes(o)))}return t.sort(((t,o)=>{const n=t[e.sortBy].toLowerCase(),c=o[e.sortBy].toLowerCase();return n.localeCompare(c)})),t},getCurrentAccount:e=>e.accounts[e.currentIndexAccount],getAccountById:e=>t=>e.accounts.find((e=>e.id===t))},actions:{setView(e){this.viewMode=e,i.saveViewConfiguration(e)},setCurrentIndexAccount(e){this.currentIndexAccount=e},setSelectedExpense(e){this.selectedExpense=e},loadAccounts(){const e=this.currentIndexAccount;this.accounts=i.loadAccounts(),this.currentIndexAccount=Math.min(e,this.accounts.length-1)},addAccount(e){if(this.accounts.some((t=>t.name.trim().toLowerCase()===e.name.trim().toLowerCase())))throw new Error("La cuenta ya existe");const n={...e,id:t()};i.addAccount(n),this.loadAccounts(),o.queueBackup()},deleteAccount(e){i.deleteAccount(e),n().onAccountDelete(e.id),this.loadAccounts(),o.queueBackup()},updateAccount(e){if(this.accounts.some((t=>t.name.trim().toLowerCase()===e.name.trim().toLowerCase()&&t.id!==e.id)))throw new Error("La cuenta ya existe");const t=this.accounts.find((t=>t.id===e.id));i.updateAccount(e),t&&t.name!==e.name&&n().onAccountUpdate(e.id,e.name),this.loadAccounts(),o.queueBackup()},addExpense(e,n){if(!n)throw new Error("Error al crear el movimiento");const c={...e,id:t()},s=this.currentIndexAccount;i.addExpenseToAccount(n,c),this.loadAccounts(),this.setCurrentIndexAccount(s),o.queueBackup()},updateExpense(e,t){i.updateExpenseInAccount(e,t),this.loadAccounts(),o.queueBackup()},deleteExpense(e,t){i.deleteExpenseFromAccount(e,t),this.loadAccounts(),o.queueBackup()},clearFilters(){this.search="",this.selectedType="all",this.sortBy="name"}}}),d=Object.freeze(Object.defineProperty({__proto__:null,useAccountsStore:l},Symbol.toStringTag,{value:"Module"}));export{c as A,r as a,a as b,i as c,d,l as u};
