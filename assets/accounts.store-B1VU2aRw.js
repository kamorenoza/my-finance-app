import{D as e,b as t}from"./vue-vendor-DpnofNfo.js";import{g as n}from"./utils-PgLBozsU.js";import{m as o}from"./index-COJKv5OF.js";import{c as s}from"./config.service-BNV0N1DJ.js";var c=(e=>(e.loan="loan",e.TC="TC",e.normal="normal",e))(c||{}),a=(e=>(e[e.list=0]="list",e[e.carousel=1]="carousel",e))(a||{});const u=[{type:"loan",label:"Créditos"},{type:"TC",label:"Tarjeta de crédito"},{type:"normal",label:"Ahorros"}],r=[{filter:"name",label:"Nombre"},{filter:"type",label:"Tipo"}],i=()=>{const e=localStorage.getItem("user"),t=e?JSON.parse(e):null;return t?t.email:null},l={loadAccounts:()=>{const e=i();if(!e)return[];const t=localStorage.getItem(`accounts_${e}`);return t?JSON.parse(t):[]},addAccount:e=>{const t=i();if(!t)return;const n=l.loadAccounts();n.push(e),localStorage.setItem(`accounts_${t}`,JSON.stringify(n))},updateAccount:e=>{const t=i();if(!t)return;const n=l.loadAccounts().map((t=>t.id===e.id?e:t));localStorage.setItem(`accounts_${t}`,JSON.stringify(n))},deleteAccount:e=>{const t=i();if(!t)return;let n=l.loadAccounts();n=n.filter((t=>t.id!==e.id)),localStorage.setItem(`accounts_${t}`,JSON.stringify(n))},saveViewConfiguration:e=>{const t=i();t&&localStorage.setItem(`viewAccountConfiguration_${t}`,JSON.stringify(e))},getViewConfiguration:()=>{const e=a.carousel,t=i();if(!t)return e;const n=`viewAccountConfiguration_${t}`,o=localStorage.getItem(n);if(o)try{return JSON.parse(o)}catch{}return localStorage.setItem(n,JSON.stringify(e)),e},addExpenseToAccount:(e,t)=>{const n=i();if(!n)return;const o=l.loadAccounts().map((n=>{if(n.id===e){const e=[...n.expenses??[],t];return{...n,expenses:e}}return n}));localStorage.setItem(`accounts_${n}`,JSON.stringify(o))},updateExpenseInAccount:(e,t)=>{const n=i();if(!n)return;const o=l.loadAccounts().map((n=>{if(n.id===e){const e=(n.expenses??[]).map((e=>e.id===t.id?t:e));return{...n,expenses:e}}return n}));localStorage.setItem(`accounts_${n}`,JSON.stringify(o))},deleteExpenseFromAccount:(e,t)=>{const n=i();if(!n)return;const o=l.loadAccounts().map((n=>{if(n.id===e){const e=(n.expenses??[]).filter((e=>e.id!==t));return{...n,expenses:e}}return n}));localStorage.setItem(`accounts_${n}`,JSON.stringify(o))}},d=()=>{const e=localStorage.getItem("user"),t=e?JSON.parse(e):null;return t?t.email:null},p={loadExpenses:()=>{const e=d();if(!e)return[];const t=localStorage.getItem(`expenses_${e}`);return t?JSON.parse(t):[]},addExpense:e=>{const t=d();if(!t)return;const n=p.loadExpenses();n.push(e),localStorage.setItem(`expenses_${t}`,JSON.stringify(n))},updateExpense:e=>{const t=d();if(!t)return;const n=p.loadExpenses().map((t=>t.id===e.id?e:t));localStorage.setItem(`expenses_${t}`,JSON.stringify(n))},deleteExpense:e=>{const t=d();if(!t)return;let n=p.loadExpenses();n=n.filter((t=>t.id!==e)),localStorage.setItem(`expenses_${t}`,JSON.stringify(n))}},f=e("expenses",(()=>{const e=t(p.loadExpenses()),c=t(s.getExpensesConfig());return{expenses:e,filterConfig:c,loadExpenses:()=>{e.value=p.loadExpenses()},addExpense:t=>{const s={...t,id:n(),date:t.date||new Date};if(p.addExpense(s),e.value.push(s),s.account?.id){const e=m();e.getAccountById(s.account.id)&&e.addExpense({description:s.name,value:s.value,type:"gasto",isPending:s.isPending??!1,date:s.date||new Date,category:null},s.account.id,s.id)}o.queueBackup()},updateExpense:t=>{const n=e.value.findIndex((e=>e.id===t.id));if(-1!==n){const s=e.value[n],c=s.account?.id,a=t.account?.id;e.value[n]=t,p.updateExpense(t);const u=m();c!==a?(c&&u.deleteExpense(c,t.id),a&&u.addExpense({description:t.name,value:t.value,type:"gasto",isPending:t.isPending??!1,date:t.date||new Date,category:null},a,t.id)):a&&u.updateExpense(a,{id:t.id,description:t.name,value:t.value,type:"gasto",isPending:t.isPending??!1,date:t.date||new Date,category:null}),o.queueBackup()}},deleteExpense:t=>{const n=e.value.findIndex((e=>e.id===t));if(-1!==n){const s=e.value[n];if(s.account?.id){m().deleteExpense(s.account.id,t)}e.value.splice(n,1),p.deleteExpense(t),o.queueBackup()}},updateExpenseAccount:(t,n)=>{const s=e.value.find((e=>e.id===t));s&&(s.account=n,p.updateExpense(s),o.queueBackup())},onAccountUpdate:(t,n)=>{e.value.forEach((e=>{e.account?.id===t&&(e.account.name=n,p.updateExpense(e))})),o.queueBackup()},onAccountDelete:t=>{e.value.forEach((e=>{e.account?.id===t&&(e.account=null,p.updateExpense(e))})),o.queueBackup()},setFilterConfiguration:(e,t)=>{c.value={groupBy:e,orderBy:t},s.saveExpensesConfig({groupBy:e,orderBy:t}),o.queueBackup()}}})),g=Object.freeze(Object.defineProperty({__proto__:null,useExpensesStore:f},Symbol.toStringTag,{value:"Module"})),m=e("accounts",{state:()=>({viewMode:l.getViewConfiguration(),accounts:l.loadAccounts(),search:"",selectedType:"all",sortBy:"name",currentIndexAccount:0,selectedExpense:null}),getters:{filteredAccounts(e){let t=[...e.accounts];if("all"!==e.selectedType&&(t=t.filter((t=>t.type===e.selectedType))),e.search.trim()){const n=e.search.toLowerCase();t=t.filter((e=>e.name.toLowerCase().includes(n)))}return t.sort(((t,n)=>{const o=t[e.sortBy].toLowerCase(),s=n[e.sortBy].toLowerCase();return o.localeCompare(s)})),t},getCurrentAccount:e=>e.accounts[e.currentIndexAccount],getAccountById:e=>t=>e.accounts.find((e=>e.id===t))},actions:{setView(e){this.viewMode=e,l.saveViewConfiguration(e)},setCurrentIndexAccount(e){this.currentIndexAccount=e},setSelectedExpense(e){this.selectedExpense=e},loadAccounts(){const e=this.currentIndexAccount;this.accounts=l.loadAccounts(),this.currentIndexAccount=Math.min(e,this.accounts.length-1)},addAccount(e){if(this.accounts.some((t=>t.name.trim().toLowerCase()===e.name.trim().toLowerCase())))throw new Error("La cuenta ya existe");const t={...e,id:n()};l.addAccount(t),this.loadAccounts(),o.queueBackup()},deleteAccount(e){l.deleteAccount(e),f().onAccountDelete(e.id),this.loadAccounts(),o.queueBackup()},updateAccount(e){if(this.accounts.some((t=>t.name.trim().toLowerCase()===e.name.trim().toLowerCase()&&t.id!==e.id)))throw new Error("La cuenta ya existe");const t=this.accounts.find((t=>t.id===e.id));l.updateAccount(e),t&&t.name!==e.name&&f().onAccountUpdate(e.id,e.name),this.loadAccounts(),o.queueBackup()},addExpense(e,t,s){if(!t)throw new Error("Error al crear el movimiento");const c={...e,id:s||n()},a=this.currentIndexAccount;l.addExpenseToAccount(t,c),this.loadAccounts(),this.setCurrentIndexAccount(a),o.queueBackup()},updateExpense(e,t){l.updateExpenseInAccount(e,t),this.loadAccounts(),o.queueBackup()},deleteExpense(e,t){l.deleteExpenseFromAccount(e,t),this.loadAccounts(),o.queueBackup()},clearFilters(){this.search="",this.selectedType="all",this.sortBy="name"}}}),x=Object.freeze(Object.defineProperty({__proto__:null,useAccountsStore:m},Symbol.toStringTag,{value:"Module"}));export{c as A,m as a,u as b,r as c,l as d,g as e,x as f,f as u};
